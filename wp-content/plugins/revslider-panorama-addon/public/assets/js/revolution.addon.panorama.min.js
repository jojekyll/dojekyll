!function(){var t,s,i=window.requestAnimationFrame;function e(t){this.slider=t,this.slides=[],this.panos=t.find("rs-slide[data-panorama]").each((function(t){0===t&&this.setAttribute("data-firstanim","t:notransition;s:d;sl:d;"),this.setAttribute("data-anim","ei:d;eo:d;s:d;r:0;t:fade;sl:d;")})),t.one("revolution.slide.onloaded",this.onLoaded.bind(this)).one("rsPanoramaDestroyed",this.destroy.bind(this))}function a(i,e,a,o){var h=JSON.parse(i.attr("data-panorama"));h=t.extend(!0,{autoplay:{enable:!1,direction:"forward",speed:100},interaction:{controls:"throw",speed:750,lockVertical:!1},zoom:{enable:!1,smooth:!0,min:75,max:150},camera:{fov:75,far:1e3},sphere:{radius:100,wsegments:100,hsegments:40},mobilelock:!1},h),this.x=0,this.y=0,this.zoomVal=1,this.width=a,this.height=o,this.slide=i,this.slider=e,this.distX=!1,this.distY=!1,this.image=h.image,this.mobilelock=h.mobilelock,this.controls=h.interaction.controls,this.lockVertical=h.interaction.lockVertical,this.drag="drag"===this.controls,this.thrw="throw"===this.controls,this.move=this.drag||this.thrw,this.mouse="mouse"===this.controls,this.click="click"===this.controls,this.autoplay=r(h.autoplay.enable),this.zoom=r(h.zoom.enable),this.smoothZoom=r(h.zoom.smooth);var d="forward"===h.autoplay.direction?1:-1;this.autoplaySpeed=.001*parseInt(h.autoplay.speed,10),this.speed=this.autoplaySpeed*d,this.throwSpeed=.001*parseInt(h.interaction.speed,10),this.zoomMax=2-.01*parseInt(h.zoom.max,10),this.zoomMin=2-.01*parseInt(h.zoom.min,10),this.fov=parseInt(h.camera.fov,10),this.onStart=this.start.bind(this),this.onZoom=this.zooming.bind(this),this.inZoom=this.zoomIn.bind(this),this.outZoom=this.zoomOut.bind(this),this.onRender=this.render.bind(this),this.onMouse=this.mouseEvent.bind(this),this.onImgChange=this.imgChange.bind(this),this.fireAction=this.onAction.bind(this),this.renderer=new THREE[s],this.renderer.setSize(a,o),this.camera=new THREE.PerspectiveCamera(this.fov,a/o,1,parseInt(h.camera.far,10)),this.camera.target=new THREE.Vector3(0,0,0);var c=new THREE.SphereGeometry(parseInt(h.sphere.radius,10),parseInt(h.sphere.wsegments,10),parseInt(h.sphere.hsegments,10));this.texture=new THREE.TextureLoader,this.texture.crossOrigin="",this.texture.minFilter=THREE.LinearFilter,c.applyMatrix((new THREE.Matrix4).makeScale(-1,1,1)),this.material=new THREE.MeshBasicMaterial,this.scene=new THREE.Scene,this.scene.add(new THREE.Mesh(c,this.material)),t.data(i[0],"rsaddonpanorama",this),this.canvas=t(this.renderer.domElement).addClass("rsaddon-panorama").appendTo(i.find("rs-sbg-wrap")),i.on("mouseleave",this.onLeave.bind(this)).find(".rs-waction").each(n,[e])}function o(t){t.stopPropagation()}function r(t){return!0===t||"true"===t||1===t||"1"===t||"on"===t}function n(t){var s=jQuery(this),i=s.attr("data-actions");if(i&&!s.hasClass("rspanoaction"))for(var e,a=(i=i.split("||")).length;a--;)(e=i[a].split("a:")).length<2||-1!==(e=e[1].split(";")[0]).search("panorama")&&s.addClass("rspanoaction").on("mousedown click mousemove touchmove",o)}window.RsAddonPanorama=function(a,o){if(s||(s=function(){var t;try{t=document.createElement("canvas"),(t=!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl")))&&(t="WebGLRenderer")}catch(t){}t||(t=window.CanvasRenderingContext2D)&&(t="CanvasRenderer");return t}())){if(a&&o&&"undefined"!=typeof THREE&&i&&o.find("rs-slide[data-panorama]").length)return(t=a).event.special.rsPanoramaDestroyed={remove:function(t){t.handler()}},new e(o)}else o.addClass("pano-no-webgl")},e.prototype={onLoaded:function(){this.slider.one("revolution.slide.onchange",this.onReady.bind(this)),jQuery(window).on("blur.rsaddonpanorama",this.onBlur.bind(this))},onReady:function(s,i){this.resize();var e=this;this.panos.each((function(s){e.slides[s]=new a(t(this),e.slider,e.width,e.height)})),this.slider.on("revolution.slide.afterdraw",this.resize.bind(this)).on("revolution.slide.onbeforeswap",this.beforeSwap.bind(this)).on("revolution.slide.onafterswap",this.afterSwap.bind(this)).on("layeraction",this.layerAction.bind(this));var o=i.currentSlide;!o||o instanceof t||(o=t(o)),o&&o.length||(o=this.slider.find("rs-slide").eq(0)),(o=t.data(o[0],"rsaddonpanorama"))&&o.onReset(),this.panos=null},beforeSwap:function(s,i){var e=t.data(i.currentslide[0],"rsaddonpanorama");e&&e.controls&&e.removeEvents(),(e=t.data(i.nextslide[0],"rsaddonpanorama"))&&e.onReset()},afterSwap:function(s,i){var e=i.currentSlide;!e||e instanceof t||(e=t(e)),e&&e.length||(e=this.slider.find("rs-slide").eq(0)),t(".rs-addon-pano-active").removeClass("rs-addon-pano-active"),e.addClass("rs-addon-pano-active"),this.currentSlide=t.data(e[0],"rsaddonpanorama"),!(e=i.prevSlide)||e instanceof t||(e=t(e)),e&&e.length&&(e=t.data(e[0],"rsaddonpanorama"))&&(e.paused=!0)},resize:function(){this.width=this.slider.width(),this.height=this.slider.height();for(var t=this.slides.length;t--;)this.slides[t].resize(this.width,this.height)},onBlur:function(){for(var t,s=this.slides.length;s--;)(t=this.slides[s]).clear(),t.canvas.trigger("mouseup").trigger("mouseleave").trigger("touchend")},layerAction:function(t,s,i,e){var a=e.action;if(a&&-1!==a.search("panorama")&&this.currentSlide){var o=!!e.hasOwnProperty("percentage")&&.05*e.percentage;this.currentSlide.action(a.replace("panorama_",""),o)}},destroy:function(){if(this.slides)for(;this.slides.length;)this.slides[0].destroy(),this.slides.shift();for(var t in this)this.hasOwnProperty(t)&&delete this[t]}},a.prototype={start:function(){this.imgLoaded||(this.imgLoaded=!0),this.currentSlide&&(this.newImage&&(this.x=0,this.y=0,this.zoomVal=1,this.camera.fov=this.fov,this.camera.updateProjectionMatrix(),this.newImage=!1),this.controller=!1,this.paused=!1,i(this.onRender),this.addEvents(),this.running=!0,this.slider.addClass("rsaddon-pano"))},render:function(){if(!this.paused&&this.camera){if(this.y=this.mobilelock||!0===this.lockVertical?0:Math.max(-85,Math.min(85,this.y)),!1!==this.distX||!1!==this.distY)!1!==this.distX?(this.x+=.05*(this.distX-this.x),Math.abs(this.distX-this.x)<1&&(this.distX=!1,clearInterval(this.actionTimer))):!1!==this.distY&&(this.y+=.05*(this.distY-this.y),Math.abs(this.distY-this.y)<1&&(this.distY=!1,clearInterval(this.actionTimer)));else if(this.controller)if(this.move){if(this.thrw)if(this.mousedown)this.vx=this.x-this.oldX,this.vy=this.y-this.oldY,this.oldX=this.x,this.oldY=this.y;else{var t=Math.abs(this.vx),s=Math.abs(this.vy);t>.01&&(this.x+=this.vx),s>.01&&(this.y+=this.vy),this.vx*=this.throwSpeed,this.vy*=this.throwSpeed,t<=.01&&s<=.01&&(this.controller=!1)}}else{var e=(this.mouseX-this.left)/this.width,a=(this.mouseY-this.top)/this.height;e=e<=.5?-180*(1-2*e):2*(e-.5)*180,a=a<=.5?85*(1-2*a):2*(a-.5)*-85,a=Math.max(-85,Math.min(85,a)),this.x+=.05*(e-this.x),this.y+=.05*(a-this.y),(this.click||this.mouse)&&Math.abs(e-this.x)<1&&Math.abs(a-this.y)<1&&(this.controller=!1)}else this.autoplay&&(this.x+=this.speed);var o=THREE.Math.degToRad(this.x),r=THREE.Math.degToRad(90-this.y);this.camera.target.x=Math.sin(r)*Math.cos(o),this.camera.target.z=Math.sin(r)*Math.sin(o),this.camera.target.y=Math.cos(r),this.camera.lookAt(this.camera.target),this.smoothZoom&&(this.camera.fov+=.05*(this.fov*this.zoomVal-this.camera.fov),this.camera.updateProjectionMatrix()),this.renderer.render(this.scene,this.camera),i(this.onRender)}},onLeave:function(){clearInterval(this.actionTimer),clearInterval(this.zoomTimer)},clear:function(){clearInterval(this.actionTimer),clearInterval(this.zoomTimer),this.distX=!1,this.distY=!1},onAction:function(){this.action(this.actionType,this.actionPerc)},action:function(t,s){var i,e;switch(t){case"left":this.distX=this.x+-180*s;break;case"right":this.distX=this.x+180*s;break;case"up":e=this.y+85*s,this.distY=Math.max(-85,Math.min(85,e));break;case"down":e=this.y+-85*s,this.distY=Math.max(-85,Math.min(85,e));break;case"leftstart":i="left";break;case"rightstart":i="right";break;case"upstart":i="up";break;case"downstart":i="down";break;case"leftend":case"rightend":case"upend":case"downend":clearInterval(this.actionTimer);break;case"zoomin":clearInterval(this.zoomTimer),this.zooming("gestureend",.5);break;case"zoomout":clearInterval(this.zoomTimer),this.zooming("gestureend",1.5);break;case"zoominstart":clearInterval(this.zoomTimer),this.inZoom(),this.zoomTimer=setInterval(this.inZoom,100);break;case"zoomoutstart":clearInterval(this.zoomTimer),this.outZoom(),this.zoomTimer=setInterval(this.outZoom,100);break;case"zoominend":case"zoomoutend":clearInterval(this.zoomTimer)}i&&(this.clear(),this.actionPerc=s,this.actionType=i,this.fireAction(),this.actionTimer=setInterval(this.fireAction,100))},zooming:function(t,s){var i;return this.prevZoom=this.zoomVal,"gestureend"!==t?(i=t.type,s=t.scale):i=t,"gestureend"!==i?t.originalEvent.wheelDelta>0||t.originalEvent.detail<0?this.zoomVal-=.05:this.zoomVal+=.05:s<1?this.zoomVal-=.05:this.zoomVal+=.05,this.zoomVal=Math.max(this.zoomMax,Math.min(this.zoomMin,this.zoomVal)),this.zoomVal!==this.zoomMax&&this.zoomVal!==this.zoomMin||clearInterval(this.zoomTimer),this.smoothZoom||(this.camera.fov=this.fov*this.zoomVal,this.camera.updateProjectionMatrix()),!1},zoomIn:function(){this.zooming("gestureend",.5)},zoomOut:function(){this.zooming("gestureend",1.5)},imgChange:function(){this.timer=setTimeout(this.onStart,500)},update:function(t,s,i){switch(clearTimeout(this.timer),this.removeEvents(),this.paused=!0,t){case"image":this.newImage=!0,this.material.map=this.texture.load(s,this.onImgChange);break;case"controls":this.controls=s,"none"!==s?(this.drag="drag"===s,this.thrw="throw"===s,this.mouse="mouse"===s,this.click="click"===s,this.move=this.drag||this.thrw):(this.x=0,this.y=0);break;case"autoplay":this.autoplay=r(s);break;case"direction":var e="forward"===s?1:-1;this.speed=this.autoplaySpeed*e;break;case"zoom":"false"==s?(delete this.zoom,this.zoomVal=1,this.camera.fov=this.fov,this.camera.updateProjectionMatrix()):this.zoom=!0;break;case"smooth":this.smoothZoom=r(s)}"image"!==t&&(this.timer=setTimeout(this.onStart,500))},resize:function(t,s){this.width=t,this.height=s,this.renderer.setSize(t,s),this.camera.aspect=t/s,this.camera.updateProjectionMatrix()},onReset:function(){this.paused=!0,this.currentSlide=!0,this.x=0,this.y=0,this.distX=!1,this.distY=!1,this.zoomVal=1,this.camera.fov=this.fov,this.camera.updateProjectionMatrix(),this.imgLoaded?this.start():this.material.map=this.texture.load(this.image,this.onStart)},enterMouse:function(t,s){this.move&&this.canvas.removeClass("rsaddon-panorama-drag").addClass("rsaddon-panorama-dragging"),this.clear(),this.controller=!0,this.mousedown=!0;var i=this.slider.offset();if(this.left=i.left,this.top=i.top,!s){var e=t.originalEvent.touches;e&&(t=e[0]),this.startX=t.pageX-this.left,this.startY=t.pageY-this.top,this.prevX=this.x,this.prevY=this.y,this.oldX=this.x,this.oldY=this.y,this.canvas.on("mousemove.rsaddonpanorama touchmove.rsaddonpanorama",this.onMouse)}},mouseEvent:function(t){if(this.onLeave(),-1!==t.type.search(/move|click/)){if(this.move){if(!this.controller||!this.mousedown)return}else this.controller||this.enterMouse(t,!0);var s=t.originalEvent.touches;s&&(t=s[0]),this.move?(this.x=this.prevX+.1*(this.startX-(t.pageX-this.left)),this.y=this.prevY+.1*(t.pageY-this.top-this.startY)):(this.mouseX=t.pageX,this.mouseY=t.pageY)}else-1!==t.type.search(/down|enter|start/)?this.enterMouse(t):(this.canvas.off("mousemove.rsaddonpanorama touchmove.rsaddonpanorama"),this.drag&&(this.controller=!1),this.mousedown=!1,this.move&&this.canvas.removeClass("rsaddon-panorama-dragging").addClass("rsaddon-panorama-drag"))},addEvents:function(){switch(this.controls){case"drag":case"throw":this.canvas.on("mousedown.rsaddonpanorama mouseup.rsaddonpanorama mouseleave.rsaddonpanorama touchstart.rsaddonpanorama touchend.rsaddonpanorama touchcancel.rsaddonpanorama",this.onMouse);break;case"click":this.slide.on("click.rsaddonpanorama",this.onMouse);break;case"mouse":this.slide.on("mousemove.rsaddonpanorama touchmove.rsaddonpanorama",this.onMouse)}this.zoom&&this.slider.on("mousewheel.rsaddonpanorama DOMMouseScroll.rsaddonpanorama gestureend.rsaddonpanorama",this.onZoom),"none"!==this.controls&&(this.move?this.canvas.addClass("rsaddon-panorama-drag"):this.click&&this.slide.addClass("rsaddon-panorama-click"))},removeEvents:function(){switch(this.clear(),this.mousedown=!1,this.controller=!1,this.currentSlide=!1,this.controls){case"drag":case"throw":this.canvas.off(".rsaddonpanorama");break;case"mouse":case"click":this.slide.off(".rsaddonpanorama")}this.slider.off(".rsaddonpanorama"),this.slide.removeClass("rsaddon-panorama-click"),this.canvas.removeClass("rsaddon-panorama-drag rsaddon-panorama-dragging")},destroy:function(){for(var t in this)this.hasOwnProperty(t)&&delete this[t]}}}();